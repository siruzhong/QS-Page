<!-- Table of Contents -->
<div id="toc-sidebar" class="toc-sidebar">
    <div class="toc-header">
        <strong>Contents</strong>
    </div>
    <nav id="toc-nav" class="toc-nav">
        <!-- TOC items will be generated by JavaScript -->
    </nav>
</div>

<script>
(function() {
    // Only show TOC on specific pages
    const tocPages = ['Publications', 'Keynote & Tutorial', 'AI for Time Series', 'AI for Education', 'LLM & AI Agent', 'Experience', 'Services & Awards'];
    const currentPage = '{{ page.navbar_title }}';
    
    if (!currentPage || !tocPages.includes(currentPage)) {
        return;
    }
    
    // Find all headings (h2, h3, h4)
    const headings = document.querySelectorAll('h2, h3, h4');
    const tocNav = document.getElementById('toc-nav');
    const tocSidebar = document.getElementById('toc-sidebar');
    
    if (headings.length === 0 || !tocNav || !tocSidebar) {
        return;
    }
    
    // Show the sidebar
    tocSidebar.classList.add('show');
    
    // Generate TOC
    headings.forEach((heading, index) => {
        // Skip if heading doesn't have text content
        if (!heading.textContent.trim()) {
            return;
        }
        
        // Create ID for heading if it doesn't exist
        let id = heading.id;
        if (!id) {
            id = 'toc-' + index + '-' + heading.textContent.trim().toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g, '-');
            heading.id = id;
        }
        
        // Create TOC item
        const tocItem = document.createElement('a');
        tocItem.href = '#' + id;
        tocItem.className = 'toc-item toc-' + heading.tagName.toLowerCase();
        tocItem.textContent = heading.textContent.trim();
        tocItem.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
                const offset = 80; // Account for fixed navbar
                const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - offset;
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
        
        tocNav.appendChild(tocItem);
    });
    
    // Highlight active section on scroll
    let currentActive = null;
    function updateActiveSection() {
        const scrollPos = window.scrollY + 100;
        let activeId = null;
        
        headings.forEach((heading) => {
            const top = heading.offsetTop;
            if (scrollPos >= top) {
                activeId = heading.id;
            }
        });
        
        if (activeId && activeId !== currentActive) {
            currentActive = activeId;
            document.querySelectorAll('.toc-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + activeId) {
                    item.classList.add('active');
                }
            });
        }
    }
    
    window.addEventListener('scroll', updateActiveSection);
    updateActiveSection();
})();
</script>
